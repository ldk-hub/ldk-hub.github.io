---
# 포스트제목
title: "JAVA 기반 MSA, SPRING CLOUD교육"
# 포스팅 작성자
author: ["이동옥"] 
# 포스팅 공개일 - 정렬기준 포스팅날짜순서에 따라 기재됨.(주의 미래날짜는 기입X)
date: 2022-04-15 08:26:28 -0400
# 블로그 메인페이지에 썸네일과 함께 노출될 텍스트 설정 일정 길이를 초과하면 잘려서 표시됨.
# abstract:
# 태그를 입력
tags: ["MSA","JAVA","SPRING","DOCKER","CI/CD"]
categories: 대시보드
# 대표 이미지를 입력합니다. 이미지 업로드 위치는 아래에 기술합니다.
# image: /assets/images/posts/nerdfactory-documentation-history/main.jpg
# 포스트의 초안 여부를 입력합니다. "no" 로 입력할 경우 공개됩니다.
draft: "no"
toc: true
---
 
 ## 실습코드 버그 발생
 버전업에따라 2.6.8버전으로 바꿔야함 모두 -->루트프로젝트에서 2.5.14버전으로바꿔야 시큐리티 소스 문제없음
 이부분도 바꿔야함
 ```
 <properties>
        <java.version>1.8</java.version>
        <spring-cloud.version>2021.0.0</spring-cloud.version>
    </properties>
 ```
 롬복도 인텔리제이 세팅설정해줘야함.
 
 ## 교육
 교육기간 : 2022.06.14 ~ 2022.06.17 
 JAVA 기반 MSA 교육 - 강사 :이도원
 
 오토스케일링
 동일한 스펙의 시스템을 자동으로 늘렸다줄었다

## msa 준비 클라이언트
  -인텔리제이
  -깃
  -비쥬얼스튜디오코드
  -포스트맨 (curl대신)
  
 ### 클라우드 네이티브
 1. MSA
 2. CI/CD pipeline
 3. Devops
 4. Container


 - docker <- 오케스트레이션(리소스관리,오토스케일링 등)도구 -> 쿠버네티스 
 - 12factors(헤로쿠) msa구성의 최소의 규칙?

최근엔 15 factors 로 증가함.

## MSA 아키텍처 도식화  
![그림1](https://user-images.githubusercontent.com/12209348/173479737-7e6d16e5-5cad-4daf-b87c-d79ab8abf3e6.png)
이너아키텍처 - > 스프링기반으로 개발된 프로그램들  
아웃터아키텍처 -> 이너아키텍처를 구성하는데 있어필요한 요소들을 구성하는 것  

## CNCF 표준구성요소 경로 -  MSA를 구성할 수 있는 요소들에대한 정보사이트
https://landscape.cncf.io/

## MSA에서 자주 사용되는 기반기술 리스트
![그림2](https://user-images.githubusercontent.com/12209348/173481608-09277965-281b-4e9c-afb8-8d90ab6cb085.png)


## 최근 MSA 동향
 - 최근엔 리본안씀(로드밸런싱역할)
 - RestTemplate 도 안쓰고 FeignClient 씀
 - 넷플릭스API 는 히스트릭스 유레카정도만 씀
 - (zuul은 사용불가됨) ->스프링클라우드 게이트웨이를 쓰게됨최근엔
  
  ## TIP
  스프링클라우드와 스프링부트 버전맞춰줘야함.
  프로퍼티스 보다->yml 추천(소스간략화)
  
  ## 인텔리제이 사용꿀팁
  쉬프트두번따닥 ->검색기능
  컨트롤+쉬푸트+에프 ->대상내 검색
  무한 undo 울티메이트 가능 ->컨트롤+쉬프트+V (코디이력 클립보드 히스토리볼수있음)

Spring cloud에서의 MSA간 통신방법 2가지
1. RestTemplate
2. feign Client(좀더 간단함)
```
//feign Client 예시코드
@FeignClient("sotres")
 public interface StoreClient{
 @RequestMapping(method=RequestMethod.GET, value="/stores")
 List<Store> getStores();
```

넷플릭스 줄, 리본 보지마 이제 더이상지원안함 넷플릭스

6월 14일
1. MSA 의 대한 개념
2. 실습 시작 -> JDK설치, Maven, spring유레카 서버, 유레카클라이언트
3. 각각의 서비스를 띄우면서 스케일 아웃 작업 
4. API Gateway  (zuul은 사용불가됨) ->스프링클라우드 게이트웨이를 쓰게됨최근엔

## 자료설치 경로 4일간
git clone https://github.com/joneconsulting/koscom-msa.git

## api 게이트웨이에서 로드밸런싱 설정하는  uri 설정
![11](https://user-images.githubusercontent.com/12209348/173518145-99f8b99e-c395-4645-bd22-a23be99af70b.PNG)




api 게이트웨이 분산처리는 서비스의 uri name을 기준으로 분배처리할 수 있다.
name 을기준으로 포워딩처리 가능
0번포트설정시 자동으로 라운드로빈 분배처리됨.


## 유레카서버에 api게이트웨이를 띄우고 -> 서비스1, 2 분배처리 까지 띄운것 까지 결과물
![444](https://user-images.githubusercontent.com/12209348/173521036-c0e309bb-f955-4440-8851-4b73790362d4.PNG)
5-bd22-a23be99af70b.PNG)

msa에서는 사이드카 기능 제공 개별의msa에필요한 공통분모구성가능 예시)인증,권한 등 - >(AOP와 같은맥락)




## 6월 15일 수
1. api 게이트웨이 리마인드
2. e-commerce 애플리케이션 개념

도커
 - 컨테이너 레지스트리(AWS ECR과 동일)

쿠버네티스(오케스트레이션)
- 워커노드역할
- 쿠버네티스 클러스터
- 리소스관리

모니터링
- 프로메테우스
- 그라파나

주문정보또는 DB정보 전달목적
 - 카프카 메세지큐 사용


1.userService 로직 구현 
마이크로서비스 내부에 사용될 스프링부트의 유저 서비스 시스템 구현
- jpa ,h2
- 스프링시큐리티
- jwt
- bootstrap.yml <<<구성정보를 관리하는 통합 경로설정


## 포스트맨 CURL 대신씀
포스트맨으로 통신여부 테스트 확인 됨 이번에 공부해볼것
각 기능 사용방법 
![포스트맨 테스트케이스](https://user-images.githubusercontent.com/12209348/173721599-9bda452f-0c31-4f88-8f72-19ec68d72492.PNG)


## 인증처리할때 jwt 토큰을 통해 처리하였음.
 - 토큰 유효기간으로 유효성 검증

1. 유저 로그인 로직MSA
2. 상품 리스트 카탈로그 MSA
3. 주문서비스 카탈로그 MSA 
 
 상호간의 토큰값을 기준으로 로그인부터 주문까지 처리 테스트 완료  
1. 로그인한다. -> 로그인했을때 생성되는 jwt 토큰을 리턴받는다  
2. 카탈로그쪽  
3. 오더서비스 주문넣을때 jwt 토큰값을 uri에포함하여 던지면 해당 유저정보로 주문을 넣은 것이 처리됨.  
tmi -> 로그인정보는 최초 apigateway에서만 처리하고 이후 msa는 jwt정보로 처리함.  

## 중요!!! MSA에서 인증처리할 때
기존의 모놀리틱에서는 아이디패스워드 정보로 로그인할 경우 세션 ID가 발급되어 진행되지만
MSA에서는 세션과 쿠키를 활용할수없기때문에 토큰기반으로 구성해서 인증을해야함
https://jwt.io/

![MSA 최종 주문처리 테스트](https://user-images.githubusercontent.com/12209348/173749008-20d99caa-d188-4e2f-9873-f7a39f44f878.PNG)




## configuration service 세션 && 스프링클라우드 버스
 - 설정정보가 변경되었을때 다운타운 없이 MSA시스템들이 자동으로 반영될 수 있도록 구성하는방법








